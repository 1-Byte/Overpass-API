<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" lang="en"></meta>
  <title>OSM3S Experimental Diff</title>
  <script src="http://localhost/firebug-lite/content/lite/firebug.js"></script>
  <script src="changeset_content_request.js"></script>
  <script src="http_wrapper.js"></script>
  <script src="osm_to_html.js"></script>
  <script src="osm_to_ol.js"></script>
  <script src="osm_xml_parser.js"></script> 
  <script src="http://localhost/OpenLayers-2.13.1/OpenLayers.debug.js"></script>
<!--  <script src="http://openlayers.org/api/2.13.1/OpenLayers.js"></script> -->
  <script src="http://overpass-api.de/OpenStreetMap.js"></script>
  <script type="text/javascript">
  
    var lat = 50.734;
    var lon = 7.100;
    var zoom = 18;
    var map;
    var layerMapnik = false;   
    
    var osm_elements = [];

    
    function init()
    {        
        map = new OpenLayers.Map ("map", {
              maxExtent: new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),
              maxResolution: 156543.0399,
              numZoomLevels: 19,
              units: 'm',
              projection: new OpenLayers.Projection("EPSG:900913"),
              displayProjection: new OpenLayers.Projection("EPSG:4326")
        } );

        layerMapnik = new OpenLayers.Layer.OSM.Mapnik("Mapnik");
        map.addLayer(layerMapnik);

        var lonLat = new OpenLayers.LonLat(lon, lat).transform(new OpenLayers.Projection("EPSG:4326"), new OpenLayers.Projection("EPSG:900913"));

        map.setCenter(lonLat, zoom);

        feature_layer = new OpenLayers.Layer.Vector("Changes", { /*style: { fillColor: "#ff0000", strokeColor: "#ff00ff" }*/ });
        map.addLayers([feature_layer]);

        var text_area = document.getElementById("textual_results");
        var osm_to_html = OsmToHtml();
        var status_bar = document.getElementById("status");
        httpXmlWrapper("http://localhost/changeset_25803449.xml",
            function(doc)
            {
                status_bar.innerHTML = "received changeset list";
                var changesets = doc.getElementsByTagName("changeset");
                if (changesets.length > 0)
                {
                    var id = "";
                    if (changesets[0].attributes && changesets[0].attributes.getNamedItem("id"))
                        id = changesets[0].attributes.getNamedItem("id").value;
                    ChangesetContentRequest()(changesets[0], status_bar, 
                        function(doc)
                        {
                            if (status_bar && status_bar.innerHTML)
                                status_bar.innerHTML = "received changeset " + id;
                            osm_elements = OsmXmlParser().processXml(doc);
                            var osm_to_ol = OsmToOpenLayers(feature_layer, osm_elements);
                            
                            text_area.appendChild(document.createTextNode("["));
                            var a = document.createElement("a");
                            a.setAttribute("href", "#");
                            a.addEventListener("click",
                                {
                                    handleEvent: osm_to_ol.show_all_elements
                                }, false);
                            a.appendChild(document.createTextNode("show all"));
                            text_area.appendChild(a);
                            text_area.appendChild(document.createTextNode("]"));
                            text_area.appendChild(document.createElement("br"));
                                
                            for (var i = 0; i < osm_elements.length; ++i)
                            {
                                text_area.appendChild(document.createElement("br"));
                                text_area.appendChild(document.createTextNode("["));
                                var a = document.createElement("a");
                                a.setAttribute("href", "#");
                                a.addEventListener("click",
                                    {
                                        handleEvent: osm_to_ol.show_single_element_closure(i)
                                    }, false);
                                a.appendChild(document.createTextNode("show"));
                                text_area.appendChild(a);
                                text_area.appendChild(document.createTextNode("]"));
                                osm_to_html.print_single_elem(osm_elements[i], text_area);
                                osm_to_ol.add_feature_to_viewport(i);
                            }
                            map.zoomToExtent(osm_to_ol.get_bounds());
                        });
                }
            });        
    }

  </script>
</head>
<body onload="init()">

<div style="position:absolute; top:0%; left:0%; height:100%; width:30%; z-index:1">
    <div style="height:10%"><strong id="status">&nbsp;</strong></div>
    <div id="textual_results" style="height:90%; overflow-y:scroll"></div>
</div>
<div id="map" class="smallmap" style="position:absolute; top:0%; left:30%; height:100%; width:70%; z-index:1"></div>

</body>
</html>
