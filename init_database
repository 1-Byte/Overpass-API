#!/bin/bash

if [[ -z $1  ]]; then
{
  echo Usage: $0 Name_of_bzip2-compressed_file
  exit 0
};
fi
PATH=./:$PATH
CONFIRM=$1
if [[ $1 != "YES" ]]; then
{
  read -p "Proceeding will drop the current databases osm_1 and osm_2 and the raw_db. Do you really want to continue? " CONFIRM
};
fi

if [[ $CONFIRM != "YES" ]]; then
{
  echo "Aborted on user request"
  exit 0
};
fi

bunzip2 <$1 | ./bin/import_osm

./init_derived_data YES

mkdir /opt/osm_why_api/osm_1/
mkdir /opt/osm_why_api/osm_2/
cp -pv /opt/osm_why_api/*.dat /opt/osm_why_api/osm_1/
cp -pv /opt/osm_why_api/*.idx /opt/osm_why_api/osm_1/
mv /opt/osm_why_api/*.dat /opt/osm_why_api/osm_2/
mv /opt/osm_why_api/*.idx /opt/osm_why_api/osm_2/
